# 🖥️ 腾讯云服务器配置指南

## 当前问题分析

根据您的输出，发现了以下问题：

1. **只读模式**：私钥未找到或交易模式初始化失败
2. **正在监听 0 个钱包**：钱包未成功添加到监听列表
3. **自动跟单已禁用**：配置中的 `autoFollow` 可能为 `false` 或未正确读取

## 解决方案

### 步骤 1：检查配置文件

在服务器上检查 `config.js`：

```bash
# SSH 连接到服务器后
cd /opt/polybot  # 或您的项目目录
cat config.js
```

确认以下配置：

```javascript
export default {
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  followSettings: {
    autoFollow: true,  // ⚠️ 必须是 true
    dryRun: false,     // ⚠️ 真实交易模式（false）或测试模式（true）
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
  },
  filters: {
    // 不设置过滤条件，避免过滤掉钱包
  }
};
```

### 步骤 2：配置私钥（方式一：环境变量，推荐）

```bash
# 编辑 ~/.bashrc 或 ~/.profile
export POLYMARKET_PRIVATE_KEY="0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b"

# 使环境变量生效
source ~/.bashrc

# 验证
echo $POLYMARKET_PRIVATE_KEY
```

### 步骤 3：配置私钥（方式二：直接写入 config.js）

如果环境变量方式不起作用，直接在 `config.js` 中配置：

```bash
# 编辑 config.js
nano config.js

# 确认 privateKey 有值
privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
```

### 步骤 4：确保网络连接正常

腾讯云服务器可能无法直接访问 Polymarket API，需要配置代理或使用其他方式。

**测试网络连接**：

```bash
# 测试连接
curl -v https://polymarket.com

# 如果连接超时，可能需要配置代理
```

### 步骤 5：修复"正在监听 0 个钱包"问题

这个问题可能是因为：
1. 钱包资料获取失败（网络问题）
2. 过滤条件太严格
3. 钱包地址不存在

**临时解决方案**：我已经改进了代码，即使获取资料失败也会尝试添加钱包。

但为了确保钱包能添加，检查：

```bash
# 运行测试脚本
node test-config.js
```

### 步骤 6：重新运行程序

```bash
# 停止当前程序（如果有）
pm2 stop polybot
# 或
pkill -f "node index.js"

# 重新运行
npm start
# 或
pm2 start index.js --name polybot
```

## 完整配置检查清单

在服务器上执行：

```bash
# 1. 检查配置文件是否存在
ls -la config.js

# 2. 检查私钥配置
grep -A 5 "privateKey" config.js

# 3. 检查 autoFollow 配置
grep -A 3 "autoFollow" config.js

# 4. 检查环境变量（如果使用）
echo $POLYMARKET_PRIVATE_KEY

# 5. 测试网络连接
curl -I https://polymarket.com

# 6. 运行配置测试
node test-config.js
```

## 快速修复命令

如果需要快速修复，在服务器上执行：

```bash
cd /opt/polybot  # 替换为您的项目路径

# 备份当前配置
cp config.js config.js.backup

# 使用正确的配置（需要手动编辑）
nano config.js
```

确保以下内容正确：

```javascript
export default {
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  followSettings: {
    autoFollow: true,   // ✅ 必须是 true
    dryRun: false,      // 真实交易模式
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
  },
  filters: {
    // 不设置过滤条件
  }
};
```

## 如果仍然显示"自动跟单已禁用"

这可能是代码逻辑问题。检查程序输出中的"配置检查"部分：

应该看到：
```
📋 配置检查:
   自动跟单: ✅ 已启用
   私钥状态: ✅ 已配置 (66 字符)
   ...
```

如果显示"❌ 已禁用"，说明 `config.followSettings.autoFollow` 不是 `true`。

**修复方法**：确保 `config.js` 中的 `autoFollow: true`（注意不要有引号，不要写成 `"true"`）。

## 网络问题解决

如果腾讯云服务器无法访问 Polymarket API：

### 方案 1：使用代理

```bash
# 设置代理环境变量
export HTTP_PROXY="http://代理地址:端口"
export HTTPS_PROXY="http://代理地址:端口"

# 运行程序
npm start
```

### 方案 2：使用 SSH 隧道

如果本地有代理，可以通过 SSH 隧道转发：

```bash
# 在本地执行（将本地代理转发到服务器）
ssh -L 7890:127.0.0.1:7890 user@服务器IP
```

## 验证修复

修复后，重新运行程序应该看到：

```
✅ poly-sdk 初始化成功（交易模式）
📋 配置检查:
   自动跟单: ✅ 已启用
   私钥状态: ✅ 已配置 (66 字符)
   交易服务: ✅ 可用
✅ 初始化完成，正在监听 2 个钱包（或更多）
🎯 使用完整的自动跟单功能（SmartMoneyService）...
```

---

**请按照以上步骤检查服务器配置，如果还有问题，告诉我具体的错误信息！**
