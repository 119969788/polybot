# ğŸ–¥ï¸ æœåŠ¡å™¨ç¨‹åºç®¡ç†æŒ‡å—

## æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

### å¦‚æœä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰

```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€
pm2 list

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show polybot

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs polybot

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
pm2 logs polybot --lines 100

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs polybot --err
```

### å¦‚æœç›´æ¥è¿è¡Œ

```bash
# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep node

# æŸ¥çœ‹è¿›ç¨‹æ ‘
pstree -p | grep node
```

## ç®¡ç†ç¨‹åº

### PM2 ç®¡ç†å‘½ä»¤

```bash
# å¯åŠ¨ç¨‹åº
pm2 start index.js --name polybot

# åœæ­¢ç¨‹åº
pm2 stop polybot

# é‡å¯ç¨‹åº
pm2 restart polybot

# é‡æ–°åŠ è½½ï¼ˆé›¶åœæœºæ—¶é—´ï¼‰
pm2 reload polybot

# åˆ é™¤è¿›ç¨‹
pm2 delete polybot

# ä¿å­˜ PM2 è¿›ç¨‹åˆ—è¡¨ï¼ˆå¼€æœºè‡ªå¯ï¼‰
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

### å¦‚æœç›´æ¥è¿è¡Œï¼ˆä½¿ç”¨ nohupï¼‰

```bash
# åœæ­¢ç¨‹åº
# å…ˆæ‰¾åˆ°è¿›ç¨‹ ID
ps aux | grep "node index.js"
kill <PID>

# æˆ–ä½¿ç”¨ pkill
pkill -f "node index.js"
```

## æ›´æ–°ä»£ç 

### æ–¹æ³•ä¸€ï¼šGit æ‹‰å–ï¼ˆæ¨èï¼‰

```bash
cd /opt/polybot  # æˆ–ä½ çš„é¡¹ç›®ç›®å½•

# å¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰
cp -r . ../polybot-backup-$(date +%Y%m%d-%H%M%S)

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœæœ‰ä¾èµ–æ›´æ–°
npm install

# é‡å¯ç¨‹åº
pm2 restart polybot
# æˆ–
pm2 reload polybot
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ä¸Šä¼ æ–‡ä»¶

```bash
# åœæ­¢ç¨‹åº
pm2 stop polybot

# ä¸Šä¼ æ–°æ–‡ä»¶ï¼ˆä½¿ç”¨ scp æˆ–å…¶ä»–å·¥å…·ï¼‰

# é‡å¯ç¨‹åº
pm2 start polybot
```

## æŸ¥çœ‹æ—¥å¿—

### PM2 æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
pm2 logs

# å®æ—¶æŸ¥çœ‹æŒ‡å®šç¨‹åºæ—¥å¿—
pm2 logs polybot

# æŸ¥çœ‹æœ€è¿‘ N è¡Œæ—¥å¿—
pm2 logs polybot --lines 50

# æ¸…ç©ºæ—¥å¿—
pm2 flush

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä½ç½®
pm2 show polybot | grep "log path"
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®

PM2 æ—¥å¿—é€šå¸¸ä¿å­˜åœ¨ï¼š
- æ ‡å‡†è¾“å‡ºï¼š`~/.pm2/logs/polybot-out.log`
- é”™è¯¯è¾“å‡ºï¼š`~/.pm2/logs/polybot-error.log`

```bash
# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f ~/.pm2/logs/polybot-out.log
tail -f ~/.pm2/logs/polybot-error.log

# æŸ¥çœ‹æœ€å 100 è¡Œ
tail -n 100 ~/.pm2/logs/polybot-out.log
```

## ç›‘æ§ç¨‹åº

### PM2 ç›‘æ§

```bash
# å®æ—¶ç›‘æ§ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰
pm2 monit

# æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯
pm2 info polybot

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
pm2 stats
```

### ç³»ç»Ÿç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
top

# æŸ¥çœ‹ Node.js è¿›ç¨‹
top -p $(pgrep -f "node index.js")

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h
```

## æŸ¥çœ‹ç›ˆåˆ©ç»Ÿè®¡

### æ–¹æ³•ä¸€ï¼šæŸ¥çœ‹æ—¥å¿—ä¸­çš„ç»Ÿè®¡

```bash
# æŸ¥çœ‹åŒ…å«ç»Ÿè®¡ä¿¡æ¯çš„æ—¥å¿—
pm2 logs polybot | grep "ç›ˆåˆ©ç»Ÿè®¡"

# æˆ–åœ¨ç¨‹åºä¸­æŒ‰ 's' é”®æŸ¥çœ‹ç»Ÿè®¡ï¼ˆå¦‚æœæ”¯æŒäº¤äº’å¼å‘½ä»¤ï¼‰
```

### æ–¹æ³•äºŒï¼šæŸ¥çœ‹æ•°æ®æ–‡ä»¶

```bash
cd /opt/polybot

# æŸ¥çœ‹ç›ˆåˆ©å†å²æ•°æ®
cat data/profit-history.json | jq '.failureReasons'

# å¦‚æœæ²¡æœ‰ jqï¼Œä½¿ç”¨ Python
python3 -m json.tool data/profit-history.json | grep -A 20 failureReasons
```

## å¸¸è§æ“ä½œåœºæ™¯

### åœºæ™¯ 1ï¼šéƒ¨ç½²æ–°åŠŸèƒ½ï¼ˆå¤±è´¥åŸå› ç»Ÿè®¡ï¼‰

```bash
cd /opt/polybot

# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœ‰æ–°ä¾èµ–ï¼‰
npm install

# 3. é‡å¯ç¨‹åºï¼ˆé›¶åœæœºï¼‰
pm2 reload polybot

# 4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤è¿è¡Œæ­£å¸¸
pm2 logs polybot --lines 50
```

### åœºæ™¯ 2ï¼šæŸ¥çœ‹å¤±è´¥åŸå› ç»Ÿè®¡

```bash
cd /opt/polybot

# æŸ¥çœ‹æ•°æ®æ–‡ä»¶
cat data/profit-history.json

# æˆ–ä½¿ç”¨ jqï¼ˆå¦‚æœå·²å®‰è£…ï¼‰æŸ¥çœ‹å¤±è´¥åŸå› 
jq '.failureReasons' data/profit-history.json

# æŸ¥çœ‹å¤±è´¥äº¤æ˜“æ•°
jq '.failedTrades' data/profit-history.json
```

### åœºæ™¯ 3ï¼šä¿®æ”¹é…ç½®åé‡å¯

```bash
cd /opt/polybot

# 1. ç¼–è¾‘é…ç½®
nano config.js

# 2. ä¿å­˜åé‡å¯
pm2 restart polybot

# 3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®ç”Ÿæ•ˆ
pm2 logs polybot --lines 20
```

### åœºæ™¯ 4ï¼šç¨‹åºå¼‚å¸¸ï¼Œéœ€è¦é‡å¯

```bash
# 1. æŸ¥çœ‹çŠ¶æ€
pm2 status

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs polybot --err --lines 50

# 3. é‡å¯ç¨‹åº
pm2 restart polybot

# 4. ç›‘æ§è¿è¡ŒçŠ¶æ€
pm2 monit
```

### åœºæ™¯ 5ï¼šè¿è¡Œè¯Šæ–­å·¥å…·

```bash
cd /opt/polybot

# è¿è¡Œè¯Šæ–­å·¥å…·
node diagnose-failures.js

# æˆ–ä½¿ç”¨ npmï¼ˆå¦‚æœå·²æ·»åŠ è„šæœ¬ï¼‰
npm run diagnose
```

## å¤‡ä»½å’Œæ¢å¤

### å¤‡ä»½æ•°æ®

```bash
cd /opt/polybot

# å¤‡ä»½æ•°æ®ç›®å½•
tar -czf backup-$(date +%Y%m%d).tar.gz data/ config.js

# å¤‡ä»½åˆ°å…¶ä»–ä½ç½®
cp -r data/ ~/backups/data-$(date +%Y%m%d)
```

### æ¢å¤æ•°æ®

```bash
# è§£å‹å¤‡ä»½
tar -xzf backup-YYYYMMDD.tar.gz

# æ¢å¤æ•°æ®ç›®å½•
cp -r backup-data/* data/
```

## å®‰å…¨å»ºè®®

1. **å®šæœŸå¤‡ä»½æ•°æ®**
   ```bash
   # è®¾ç½®æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ï¼ˆæ·»åŠ åˆ° crontabï¼‰
   0 2 * * * cd /opt/polybot && tar -czf ~/backups/backup-$(date +\%Y\%m\%d).tar.gz data/
   ```

2. **ç›‘æ§æ—¥å¿—å¤§å°**
   ```bash
   # PM2 æ—¥å¿—è½®è½¬ï¼ˆè‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—ï¼‰
   pm2 install pm2-logrotate
   ```

3. **æ£€æŸ¥ç¨‹åºå¥åº·çŠ¶æ€**
   ```bash
   # è®¾ç½®è¿›ç¨‹ç›‘æ§ï¼ˆè‡ªåŠ¨é‡å¯å´©æºƒçš„ç¨‹åºï¼‰
   pm2 start index.js --name polybot --max-restarts 10
   ```

## å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs polybot

# é‡å¯ç¨‹åº
pm2 restart polybot

# åœæ­¢ç¨‹åº
pm2 stop polybot

# å¯åŠ¨ç¨‹åº
pm2 start polybot

# æŸ¥çœ‹ç›‘æ§
pm2 monit

# æ›´æ–°ä»£ç 
cd /opt/polybot && git pull && pm2 restart polybot
```
