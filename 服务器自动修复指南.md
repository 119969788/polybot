# 🛠️ 服务器配置自动修复指南

## 快速使用

我已经创建了自动修复脚本 `fix-server-config.sh`，可以自动检查和修复服务器配置问题。

### 在服务器上运行

```bash
# 1. 上传脚本到服务器
# 或者直接在服务器上创建脚本

# 2. 进入项目目录
cd /opt/polybot  # 替换为您的项目路径

# 3. 运行修复脚本
bash fix-server-config.sh

# 或者指定项目目录
bash fix-server-config.sh /opt/polybot
```

## 脚本功能

自动修复脚本会：

1. ✅ **检查配置文件是否存在**
   - 如果不存在，从 `config.example.js` 创建

2. ✅ **备份当前配置**
   - 自动备份到 `config.js.backup.时间戳`

3. ✅ **检查配置问题**
   - 检查私钥是否配置
   - 检查 `autoFollow` 是否启用
   - 检查 `targetWallets` 是否配置

4. ✅ **自动修复配置**
   - 配置私钥
   - 启用自动跟单
   - 配置目标钱包列表
   - 设置真实交易模式

5. ✅ **验证配置**
   - 使用 Node.js 验证配置语法
   - 显示配置摘要

## 配置内容

脚本会自动配置：

```javascript
{
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  followSettings: {
    autoFollow: true,
    dryRun: false,  // 真实交易模式
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
  },
  filters: {
    // 不设置过滤条件
  }
}
```

## 自定义配置

如果需要修改配置，编辑脚本中的变量：

```bash
# 修改私钥
PRIVATE_KEY="您的私钥"

# 修改目标钱包
TARGET_WALLETS=(
  "钱包地址1"
  "钱包地址2"
)
```

## 手动修复（如果脚本不工作）

如果自动修复脚本不工作，可以手动修复：

### 1. 备份配置文件

```bash
cp config.js config.js.backup
```

### 2. 编辑配置文件

```bash
nano config.js
```

### 3. 确保以下配置正确

```javascript
export default {
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  followSettings: {
    autoFollow: true,   // ⚠️ 必须是 true
    dryRun: false,      // 真实交易模式
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
  },
  filters: {
    // 不设置过滤条件
  }
};
```

### 4. 保存并验证

```bash
# 验证配置
node -e "import('./config.js').then(c => console.log('配置加载成功:', c.default.followSettings?.autoFollow))"
```

## 运行修复脚本的完整流程

```bash
# 1. SSH 连接到服务器
ssh user@your-server-ip

# 2. 进入项目目录
cd /opt/polybot

# 3. 下载或创建修复脚本（如果还没有）
# wget https://your-repo/fix-server-config.sh
# 或直接创建脚本文件

# 4. 添加执行权限
chmod +x fix-server-config.sh

# 5. 运行修复脚本
./fix-server-config.sh

# 6. 按照提示确认修复

# 7. 验证配置
node test-config.js

# 8. 运行程序
npm start
```

## 预期结果

修复后，运行程序应该看到：

```
✅ poly-sdk 初始化成功（交易模式）
📋 配置检查:
   自动跟单: ✅ 已启用
   私钥状态: ✅ 已配置 (66 字符)
   交易服务: ✅ 可用
   测试模式: ❌ 否
✅ 初始化完成，正在监听 2 个钱包
🎯 使用完整的自动跟单功能（SmartMoneyService）...
```

## 故障排除

### 问题：脚本无法运行

```bash
# 检查文件权限
ls -l fix-server-config.sh

# 添加执行权限
chmod +x fix-server-config.sh

# 使用 bash 运行
bash fix-server-config.sh
```

### 问题：配置验证失败

```bash
# 检查 Node.js 版本
node --version

# 需要 Node.js 18+ 支持 ES modules

# 检查配置文件语法
node --check config.js
```

### 问题：需要恢复备份

```bash
# 查看备份文件
ls -l config.js.backup.*

# 恢复备份
cp config.js.backup.20240101_120000 config.js
```

## 安全提示

⚠️ **重要**：
1. 修复脚本中包含私钥，请确保脚本文件权限正确
2. 修复后，建议设置文件权限：`chmod 600 config.js`
3. 不要将包含私钥的配置文件提交到 Git

---

**现在您可以在服务器上运行 `bash fix-server-config.sh` 自动修复配置！**
