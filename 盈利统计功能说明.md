# 📊 盈利统计功能说明

## 功能概述

已成功添加盈利统计功能，可以自动跟踪和统计所有跟单交易的盈利情况。

## 功能特性

### ✅ 已实现的功能

1. **交易记录**
   - 自动记录每笔买入和卖出交易
   - 记录交易详情（钱包地址、代币、金额、价格等）
   - 自动匹配买入和卖出交易计算盈利

2. **统计维度**
   - 📊 总体统计：总交易数、盈利/亏损交易数、胜率
   - 💰 金额统计：总盈利、总亏损、净利润、平均盈利/亏损
   - 👛 按钱包统计：每个钱包的交易表现
   - 🪙 按代币统计：每个代币的交易表现
   - 📅 每日统计：按日期统计交易表现
   - ⚡ 效率统计：交易频率、运行时间等

3. **自动保存**
   - 自动保存历史数据到 `data/profit-history.json`
   - 程序启动时自动加载历史数据
   - 定期自动保存（默认 1 分钟）

4. **定期显示**
   - 可配置定期显示统计信息（默认每 30 分钟）
   - 程序退出时显示完整统计报告
   - 运行中可按 "s" 键随时查看统计

## 配置说明

在 `config.js` 中可以配置盈利统计：

```javascript
// 盈利统计配置
profitTracking: {
  // 是否启用盈利统计
  enabled: true,
  
  // 自动保存间隔（毫秒）- 默认 1 分钟
  autoSaveInterval: 60000,
  
  // 定期显示统计信息的间隔（分钟）- 0 表示不自动显示
  displayInterval: 30,  // 每 30 分钟显示一次统计
},
```

## 使用方法

### 自动使用

盈利统计功能已自动集成到程序中，无需额外操作。当有交易执行时，会自动记录。

### 手动查看统计

#### 方法一：运行时按 "s" 键

程序运行中，按 `s` 键可以随时查看盈利统计：

```
⏳ 程序运行中... (按 Ctrl+C 退出)
💡 提示: 运行中按 "s" 键可以随时查看盈利统计

[按 s 键]
```

#### 方法二：程序退出时自动显示

按 `Ctrl+C` 退出程序时，会自动显示完整的盈利统计报告。

#### 方法三：代码调用

```javascript
// 在代码中调用
follower.displayProfitStats();
// 或
follower.getProfitSummary();
```

## 统计报告示例

```
╔════════════════════════════════════════════╗
║           盈利统计报告                    ║
╚════════════════════════════════════════════╝

📊 总体统计:
   总交易数: 10
   盈利交易: 6 (60.00%)
   亏损交易: 4
   持平交易: 0

💰 金额统计:
   总盈利: $150.50
   总亏损: $80.25
   净利润: $70.25 ✅
   平均盈利: $25.08
   平均亏损: $20.06
   盈亏比: 1.88

⚡ 效率统计:
   运行时间: 120 分钟
   交易频率: 5.00 笔/小时

👛 按钱包统计 (Top 5):
   1. 0xe00740bc...
      交易: 5 | 盈利: $45.20
   2. 0x6031b6ee...
      交易: 5 | 盈利: $25.05

🪙 按代币统计 (Top 5):
   1. USDC
      交易: 3 | 盈利: $30.50

📅 每日统计 (最近 7 天):
   2024-01-10: 5 笔 | 净利润: $45.20
   2024-01-09: 3 笔 | 净利润: $25.05
```

## 数据存储

盈利数据保存在 `data/profit-history.json` 文件中，包括：

- 所有交易记录
- 统计汇总
- 按钱包、代币、日期的分类统计
- 程序运行时间

数据会在程序退出时自动保存，也可以在运行期间定期自动保存。

## 注意事项

1. **首次运行**：首次运行时不会有历史数据，这是正常的
2. **数据持久化**：盈利数据会保存在 `data/` 目录下，确保目录有写入权限
3. **匹配交易**：盈利计算基于 FIFO（先进先出）原则匹配买入和卖出交易
4. **测试模式**：在测试模式下，盈利统计仍然会记录，但不会执行真实交易

## 高级配置

### 禁用盈利统计

如果不需要盈利统计，可以在配置中禁用：

```javascript
profitTracking: {
  enabled: false,
},
```

### 调整显示间隔

```javascript
profitTracking: {
  enabled: true,
  displayInterval: 60,  // 改为每 60 分钟显示一次
},
```

### 调整保存间隔

```javascript
profitTracking: {
  enabled: true,
  autoSaveInterval: 300000,  // 改为每 5 分钟保存一次
},
```

## 故障排除

### 问题：统计数据不准确

- 确保买入和卖出交易都有正确记录
- 检查交易匹配逻辑是否正确
- 查看 `data/profit-history.json` 文件内容

### 问题：无法保存数据

- 检查 `data/` 目录是否存在且有写入权限
- 查看控制台错误信息

### 问题：按 "s" 键不工作

- 确保程序在前台运行（不是后台进程）
- 某些终端可能不支持键盘输入

## 未来改进

可能的增强功能：

- [ ] 导出 CSV 报告
- [ ] 图表可视化
- [ ] 更多统计指标（夏普比率、最大回撤等）
- [ ] 实时 Web 仪表板
- [ ] 邮件/通知报告

---

**盈利统计功能已完全集成，可以立即使用！**
