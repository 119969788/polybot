# 🔧 解决"正在监听 0 个钱包"问题

## 问题描述

程序运行后显示：
```
✅ 初始化完成，正在监听 0 个钱包
ℹ️  自动跟单已禁用
```

## 可能的原因

### 1. SDK 初始化失败（交易模式）

**现象**：
- 显示"✅ poly-sdk 初始化成功（只读模式）"
- 但应该显示"✅ poly-sdk 初始化成功（交易模式）"

**原因**：
- 钱包未在 Polymarket 注册
- 网络连接问题
- 私钥错误

**解决方案**：

#### 方法一：注册钱包到 Polymarket

1. 访问 Polymarket 官网
2. 连接钱包
3. 完成注册流程

#### 方法二：检查网络连接

```bash
# 检查网络连接
ping polymarket.com

# 如果无法访问，可能需要配置代理
```

#### 方法三：检查私钥

```bash
# 验证私钥格式
# 私钥应该是 64 个十六进制字符（不含 0x 前缀）
# 或 66 个字符（含 0x 前缀）

# 检查 config.js 中的私钥
cat config.js | grep privateKey
```

### 2. 目标钱包地址问题

**现象**：
- 配置了 `targetWallets`，但仍然显示 0 个钱包

**可能原因**：
- 钱包地址格式错误
- 钱包未在 Polymarket 上注册
- API 调用失败

**解决方案**：

#### 检查钱包地址格式

钱包地址应该是：
- 42 个字符（包含 `0x` 前缀）
- 正确的以太坊地址格式

```javascript
// 正确格式
targetWallets: [
  '0xe00740bce98a594e26861838885ab310ec3b548c',
  '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
]
```

#### 验证钱包地址是否有效

```bash
# 使用诊断工具
npm run diagnose
# 或
node diagnose-failures.js
```

### 3. 从排行榜获取失败

**现象**：
- `targetWallets` 为空，从排行榜获取
- 显示"✅ 成功加载 10 名交易者"，但最终监听 0 个钱包

**可能原因**：
- 所有交易者都被过滤掉了
- API 调用失败
- 网络问题

**解决方案**：

#### 检查过滤条件

```javascript
// 如果过滤条件太严格，所有钱包都会被过滤
filters: {
  // minWinRate: 0,  // 注释掉或设置为 0
  // minSmartScore: 0,  // 注释掉或设置为 0
  excludeTokens: [],
}
```

#### 临时禁用过滤

```javascript
filters: {
  // 全部注释掉，不设置任何过滤条件
  excludeTokens: [],
}
```

## 诊断步骤

### 步骤 1: 检查配置

```bash
# 查看配置文件
cat config.js | grep -A 5 "targetWallets"
cat config.js | grep -A 5 "autoFollow"
```

### 步骤 2: 运行诊断工具

```bash
cd /opt/polybot
npm run diagnose
# 或
node diagnose-failures.js
```

### 步骤 3: 检查日志

查看详细错误信息：

```bash
# 如果使用 PM2
pm2 logs polybot

# 如果直接运行
npm start 2>&1 | tee polybot.log
```

### 步骤 4: 测试钱包地址

尝试手动验证钱包地址：

```javascript
// 在 Node.js REPL 中测试
node
> const sdk = new PolymarketSDK();
> await sdk.wallets.getWalletProfile('0xe00740bce98a594e26861838885ab310ec3b548c');
```

## 快速修复方案

### 方案一：使用已知有效的钱包地址

```javascript
// 使用一些已知有效的钱包地址（需要替换为实际有效的地址）
targetWallets: [
  '0xe00740bce98a594e26861838885ab310ec3b548c',
  '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
],
```

### 方案二：禁用过滤条件

```javascript
filters: {
  // 全部注释掉
  excludeTokens: [],
}
```

### 方案三：检查网络和代理

```bash
# 如果在中国大陆，可能需要配置代理
export HTTP_PROXY=http://127.0.0.1:7890
export HTTPS_PROXY=http://127.0.0.1:7890
npm start
```

## 配置示例（推荐）

```javascript
export default {
  sdk: {
    privateKey: process.env.POLYMARKET_PRIVATE_KEY || '你的私钥',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  topTradersCount: 10,
  followSettings: {
    autoFollow: true,
    dryRun: true,  // 测试模式
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
    maxSlippage: 0.05,
    orderType: 'FAK',
  },
  filters: {
    // 不设置任何过滤条件
    excludeTokens: [],
  }
};
```

## 验证修复

修复后重新运行：

```bash
npm start
```

应该看到：
```
✅ 初始化完成，正在监听 X 个钱包（X > 0）
🎯 自动跟单已启用
```

---

**如果问题仍然存在，请查看详细日志并提供错误信息！**
