# 🔑 私钥配置指南

## 配置方式

### 方式一：直接在 config.js 中填入（简单但不推荐）

**优点**：配置简单，直接可用  
**缺点**：安全性较低，如果代码泄露，私钥也会泄露

**步骤**：

1. 编辑 `config.js` 文件：
```bash
# 本地
code config.js
# 或
nano config.js

# 服务器
cd /opt/polybot
nano config.js
```

2. 找到 `sdk` 部分，修改 `privateKey`：
```javascript
sdk: {
  // 方式2：如果环境变量不起作用，临时直接填入（仅用于测试）
  privateKey: '0x你的私钥',  // ✅ 在这里填入您的私钥
  
  chainId: 137,
},
```

**示例**：
```javascript
sdk: {
  privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
  chainId: 137,
},
```

### 方式二：使用环境变量（推荐，更安全）

**优点**：更安全，私钥不会存储在代码中  
**缺点**：需要配置环境变量

#### Linux/Mac 服务器：

**方法 A：临时设置（当前会话有效）**
```bash
export POLYMARKET_PRIVATE_KEY="0x你的私钥"
npm start
```

**方法 B：永久设置（推荐）**

1. 编辑 `~/.bashrc` 或 `~/.bash_profile`：
```bash
nano ~/.bashrc
```

2. 添加：
```bash
export POLYMARKET_PRIVATE_KEY="0x你的私钥"
```

3. 重新加载：
```bash
source ~/.bashrc
```

**方法 C：使用 .env 文件（推荐用于项目）**

1. 创建 `.env` 文件：
```bash
cd /opt/polybot
echo "POLYMARKET_PRIVATE_KEY=0x你的私钥" > .env
chmod 600 .env  # 设置权限，仅用户可读
```

2. 在 `config.js` 中：
```javascript
sdk: {
  privateKey: process.env.POLYMARKET_PRIVATE_KEY || '',
  chainId: 137,
},
```

3. 使用 `dotenv` 包加载（如果需要）：
```bash
npm install dotenv
```

#### Windows：

**方法 A：命令行（当前会话）**
```cmd
set POLYMARKET_PRIVATE_KEY=0x你的私钥
npm start
```

**方法 B：PowerShell（当前会话）**
```powershell
$env:POLYMARKET_PRIVATE_KEY="0x你的私钥"
npm start
```

**方法 C：系统环境变量（永久）**
1. 右键"此电脑" → 属性
2. 高级系统设置 → 环境变量
3. 新建用户变量：
   - 变量名：`POLYMARKET_PRIVATE_KEY`
   - 变量值：`0x你的私钥`

## 私钥格式

私钥应该是：
- 64 个十六进制字符（不含 `0x` 前缀）
- 或 66 个字符（含 `0x` 前缀）

**正确格式**：
```
0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b
```

**错误格式**：
- 长度不对
- 包含非十六进制字符
- 缺少 `0x` 前缀（可选，但建议包含）

## 在服务器上配置私钥

### 快速方法（直接编辑 config.js）：

```bash
cd /opt/polybot

# 备份配置文件
cp config.js config.js.bak

# 编辑配置文件
nano config.js
```

找到第 25 行左右，修改为：
```javascript
privateKey: '0x你的私钥',  // 替换为您的实际私钥
```

保存：`Ctrl+O`, `Enter`, `Ctrl+X`

### 使用环境变量（推荐）：

```bash
cd /opt/polybot

# 方法1：临时设置
export POLYMARKET_PRIVATE_KEY="0x你的私钥"
npm start

# 方法2：永久设置（添加到 ~/.bashrc）
echo 'export POLYMARKET_PRIVATE_KEY="0x你的私钥"' >> ~/.bashrc
source ~/.bashrc

# 方法3：创建 .env 文件
echo "POLYMARKET_PRIVATE_KEY=0x你的私钥" > .env
chmod 600 .env
```

然后在 `config.js` 中：
```javascript
sdk: {
  privateKey: process.env.POLYMARKET_PRIVATE_KEY || '',
  chainId: 137,
},
```

## 验证配置

配置后，运行诊断工具验证：

```bash
cd /opt/polybot
npm run diagnose
# 或
node diagnose-failures.js
```

应该看到：
```
🔑 私钥检查: ✅ 已找到 (66 字符)
```

或运行程序：
```bash
npm start
```

应该看到：
```
🔑 私钥检查: ✅ 已找到 (66 字符)
✅ poly-sdk 初始化成功（交易模式）
```

## 安全提示

⚠️ **重要安全提示**：

1. **永远不要将私钥提交到 Git**：
   - 确保 `config.js` 在 `.gitignore` 中
   - 如果私钥泄露，立即更换钱包

2. **使用环境变量（推荐）**：
   - 私钥不存储在代码中
   - 更安全，易于管理

3. **设置文件权限**：
   ```bash
   chmod 600 config.js  # 仅用户可读写
   chmod 600 .env       # 如果使用 .env 文件
   ```

4. **定期检查**：
   - 定期检查账户安全
   - 如果怀疑泄露，立即更换钱包

5. **备份私钥**：
   - 安全地备份私钥（离线存储）
   - 不要存储在云端或共享位置

## 常见问题

### Q1: 私钥格式错误

**错误信息**：
```
Invalid private key format
```

**解决方案**：
- 确保私钥是 64 个十六进制字符
- 确保包含 `0x` 前缀（可选）
- 检查是否有空格或特殊字符

### Q2: 环境变量不生效

**解决方案**：
```bash
# 检查环境变量
echo $POLYMARKET_PRIVATE_KEY

# 如果为空，重新设置
export POLYMARKET_PRIVATE_KEY="0x你的私钥"

# 验证
echo $POLYMARKET_PRIVATE_KEY
```

### Q3: 配置文件中的私钥不生效

**解决方案**：
- 检查语法是否正确（引号、逗号）
- 检查是否有注释符号 `//` 或 `/* */`
- 重新运行程序

### Q4: 私钥泄露怎么办？

**紧急处理**：
1. 立即将资金转移到新钱包
2. 更换所有相关账户的私钥
3. 检查是否有未授权交易
4. 如果使用了 Git，立即从历史记录中删除（复杂操作）

---

**配置私钥后，记得保持安全，不要泄露！**
