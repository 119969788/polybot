# 📝 在服务器上直接创建修复脚本

## 方法一：使用 cat 命令创建脚本（最简单）

在服务器上直接执行以下命令创建脚本：

```bash
# 1. 进入项目目录
cd /opt/polybot  # 或您的项目路径

# 2. 创建修复脚本
cat > fix-server-config.sh << 'SCRIPT_EOF'
#!/bin/bash

echo "PolyBot 服务器配置修复脚本"
echo ""

PROJECT_DIR="$(pwd)"
CONFIG_FILE="$PROJECT_DIR/config.js"
CONFIG_BACKUP="$PROJECT_DIR/config.js.backup.$(date +%Y%m%d_%H%M%S)"

PRIVATE_KEY="0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b"

echo "项目目录: $PROJECT_DIR"
echo ""

# 检查配置文件
if [ ! -f "$CONFIG_FILE" ]; then
    echo "❌ 配置文件不存在: $CONFIG_FILE"
    exit 1
fi

# 备份
echo "📦 备份配置文件..."
cp "$CONFIG_FILE" "$CONFIG_BACKUP"
echo "✅ 已备份到: $CONFIG_BACKUP"
echo ""

# 创建修复后的配置
cat > "$CONFIG_FILE" << 'CONFIG_EOF'
/**
 * 钱包跟单配置
 */

export default {
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  topTradersCount: 10,
  followSettings: {
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
    maxSlippage: 0.03,
    orderType: 'FOK',
    autoFollow: true,
    dryRun: false,
    watchInterval: 5000,
  },
  filters: {
    excludeTokens: [],
  }
};
CONFIG_EOF

echo "✅ 配置已修复"
echo ""
echo "📋 修复后的配置摘要:"
echo "   私钥: ✅ 已配置"
echo "   自动跟单: ✅ 已启用"
echo "   目标钱包: ✅ 已配置 (2 个)"
echo "   测试模式: ❌ 已禁用（真实交易模式）"
echo ""

# 验证配置
echo "🔍 验证配置..."
if node -e "import('./config.js').then(c => { const cfg = c.default; console.log('验证成功:'); console.log('  私钥:', cfg.sdk?.privateKey ? '✅ (' + cfg.sdk.privateKey.length + ' 字符)' : '❌'); console.log('  自动跟单:', cfg.followSettings?.autoFollow === true ? '✅' : '❌'); console.log('  目标钱包:', cfg.targetWallets?.length || 0, '个'); }).catch(e => console.error('❌ 验证失败:', e.message));" 2>&1; then
    echo ""
    echo "✅ 配置验证通过"
else
    echo ""
    echo "❌ 配置验证失败，请手动检查"
    echo "💡 可以使用备份文件恢复: $CONFIG_BACKUP"
fi

echo ""
echo "下一步: npm start"
SCRIPT_EOF

# 3. 添加执行权限
chmod +x fix-server-config.sh

# 4. 运行脚本
./fix-server-config.sh
```

## 方法二：手动创建配置文件（更简单）

如果脚本创建复杂，可以直接创建配置文件：

```bash
# 1. 进入项目目录
cd /opt/polybot

# 2. 备份现有配置（如果存在）
cp config.js config.js.backup.$(date +%Y%m%d_%H%M%S) 2>/dev/null || true

# 3. 创建正确的配置文件
cat > config.js << 'EOF'
/**
 * 钱包跟单配置
 */

export default {
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  topTradersCount: 10,
  followSettings: {
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
    maxSlippage: 0.03,
    orderType: 'FOK',
    autoFollow: true,
    dryRun: false,
    watchInterval: 5000,
  },
  filters: {
    excludeTokens: [],
  }
};
EOF

# 4. 验证配置
node -e "import('./config.js').then(c => { const cfg = c.default; console.log('配置验证:'); console.log('  私钥:', cfg.sdk?.privateKey ? '✅ (' + cfg.sdk.privateKey.length + ' 字符)' : '❌'); console.log('  自动跟单:', cfg.followSettings?.autoFollow === true ? '✅' : '❌'); console.log('  目标钱包:', cfg.targetWallets?.length || 0, '个'); }).catch(e => console.error('❌ 验证失败:', e.message));"

# 5. 运行程序
npm start
```

## 方法三：使用 nano 手动编辑（推荐）

如果上面的方法都不行，使用编辑器手动编辑：

```bash
# 1. 进入项目目录
cd /opt/polybot

# 2. 备份现有配置
cp config.js config.js.backup.$(date +%Y%m%d_%H%M%S) 2>/dev/null || true

# 3. 编辑配置文件
nano config.js
```

在编辑器中，确保以下内容正确：

```javascript
export default {
  sdk: {
    privateKey: '0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b',
    chainId: 137,
  },
  targetWallets: [
    '0xe00740bce98a594e26861838885ab310ec3b548c',
    '0x6031b6eed1c97e853c6e0f03ad3ce3529351f96d',
  ],
  topTradersCount: 10,
  followSettings: {
    sizeScale: 0.1,
    maxSizePerTrade: 10,
    minTradeSize: 1,
    maxSlippage: 0.03,
    orderType: 'FOK',
    autoFollow: true,   // ⚠️ 必须是 true
    dryRun: false,      // 真实交易模式
    watchInterval: 5000,
  },
  filters: {
    excludeTokens: [],
  }
};
```

保存：`Ctrl+O`，回车，`Ctrl+X`

## 验证配置

修复后，验证配置：

```bash
# 测试配置读取
node -e "import('./config.js').then(c => { const cfg = c.default; console.log('配置检查:'); console.log('私钥:', cfg.sdk?.privateKey ? '✅ 已配置' : '❌ 未配置'); console.log('autoFollow:', cfg.followSettings?.autoFollow); console.log('targetWallets:', cfg.targetWallets?.length || 0, '个'); }).catch(console.error);"
```

## 运行程序

配置修复后，运行程序：

```bash
npm start
```

应该看到：

```
✅ poly-sdk 初始化成功（交易模式）
📋 配置检查:
   自动跟单: ✅ 已启用
   私钥状态: ✅ 已配置 (66 字符)
   交易服务: ✅ 可用
✅ 初始化完成，正在监听 2 个钱包
🎯 使用完整的自动跟单功能（SmartMoneyService）...
```

---

**最简单的方法：使用方法二直接创建配置文件！**
